import{g as n,f as s,G as a}from"./common-bec3f312.js";const t='{"title":"WebSocket & Redis 快速入门","frontmatter":{"date":"2022-05-25","title":"WebSocket & Redis 快速入门","tags":["前端架构师","week30","脚手架"],"describe":null},"headers":[{"level":2,"title":"WebSocket 入门","slug":"websocket-入门"},{"level":3,"title":"什么是 WebSocket？","slug":"什么是-websocket？"},{"level":3,"title":"WebSocket 开发流程","slug":"websocket-开发流程"},{"level":3,"title":"WebSocket 服务开发流程","slug":"websocket-服务开发流程"},{"level":3,"title":"WebSocket 客户端开发流程","slug":"websocket-客户端开发流程"},{"level":2,"title":"Redis 入门","slug":"redis-入门"},{"level":3,"title":"什么是 Redis？","slug":"什么是-redis？"},{"level":2,"title":"Redis 安装方法","slug":"redis-安装方法"},{"level":3,"title":"Redis 开发流程","slug":"redis-开发流程"}],"relativePath":"docs/Front_arch/week30/02.md","lastUpdated":1660147426756.5005}';var p={};const o=a('<h1 id="websocket-redis-快速入门"><a class="header-anchor" href="#websocket-redis-快速入门" aria-hidden="true">#</a> WebSocket &amp; Redis 快速入门</h1><h2 id="websocket-入门"><a class="header-anchor" href="#websocket-入门" aria-hidden="true">#</a> WebSocket 入门</h2><h3 id="什么是-websocket？"><a class="header-anchor" href="#什么是-websocket？" aria-hidden="true">#</a> 什么是 WebSocket？</h3><p>WebSocket 基本概念：<a href="https://www.runoob.com/html/html5-websocket.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/html/html5-websocket.html</a></p><h3 id="websocket-开发流程"><a class="header-anchor" href="#websocket-开发流程" aria-hidden="true">#</a> WebSocket 开发流程</h3><p>WebSocket 开发流程：<a href="https://eggjs.org/zh-cn/tutorials/socketio.html" target="_blank" rel="noopener noreferrer">https://eggjs.org/zh-cn/tutorials/socketio.html</a></p><h3 id="websocket-服务开发流程"><a class="header-anchor" href="#websocket-服务开发流程" aria-hidden="true">#</a> WebSocket 服务开发流程</h3><ol><li>安装依赖</li></ol><div class="language-bash"><pre><code><span class="token function">npm</span> i -S egg-socket.io\n</code></pre></div><ol><li>更新配置文件</li></ol><div class="language-js"><pre><code><span class="token comment">// config.default.js</span>\nconfig<span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token punctuation">{</span>\n  namespace<span class="token operator">:</span> <span class="token punctuation">{</span>\n    <span class="token string">&#39;/&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      connectionMiddleware<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      packetMiddleware<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;filter&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n    <span class="token string">&#39;/chat&#39;</span><span class="token operator">:</span> <span class="token punctuation">{</span>\n      connectionMiddleware<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;auth&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n      packetMiddleware<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>\n    <span class="token punctuation">}</span><span class="token punctuation">,</span>\n  <span class="token punctuation">}</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n\n<span class="token comment">// plugin.js</span>\nexports<span class="token punctuation">.</span>io <span class="token operator">=</span> <span class="token punctuation">{</span>\n  enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>\n  <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">&#39;egg-socket.io&#39;</span><span class="token punctuation">,</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre></div><ol><li>修改路由配置</li></ol><div class="language-js"><pre><code><span class="token comment">// router.js</span>\n\n<span class="token comment">// app.io.of(&#39;/&#39;)</span>\napp<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&#39;chat&#39;</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>io<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n\n<span class="token comment">// app.io.of(&#39;/chat&#39;)</span>\napp<span class="token punctuation">.</span>io<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&#39;/chat&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">route</span><span class="token punctuation">(</span><span class="token string">&#39;chat&#39;</span><span class="token punctuation">,</span> app<span class="token punctuation">.</span>io<span class="token punctuation">.</span>controller<span class="token punctuation">.</span>chat<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre></div><ol><li>开发 middleware</li></ol><div class="language-js"><pre><code><span class="token comment">// app/io/middleware/auth.js</span>\n<span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">return</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n    <span class="token keyword">const</span> say <span class="token operator">=</span> <span class="token keyword">await</span> ctx<span class="token punctuation">.</span>service<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    ctx<span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;auth!&#39;</span> <span class="token operator">+</span> say<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;disconnect!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre></div><ol><li>开发 controller</li></ol><div class="language-js"><pre><code><span class="token comment">// app/io/controller/chat.js</span>\n<span class="token string">&#39;use strict&#39;</span><span class="token punctuation">;</span>\n\nmodule<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  <span class="token keyword">class</span> <span class="token class-name">Controller</span> <span class="token keyword">extends</span> <span class="token class-name">app<span class="token punctuation">.</span>Controller</span> <span class="token punctuation">{</span>\n    <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\n      <span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\n      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;chat :&#39;</span><span class="token punctuation">,</span> message <span class="token operator">+</span> <span class="token string">&#39; : &#39;</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">const</span> say <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>service<span class="token punctuation">.</span>user<span class="token punctuation">.</span><span class="token function">say</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n      <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> say<span class="token punctuation">)</span><span class="token punctuation">;</span>\n    <span class="token punctuation">}</span>\n  <span class="token punctuation">}</span>\n\n  <span class="token keyword">return</span> Controller<span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\n</code></pre></div><h3 id="websocket-客户端开发流程"><a class="header-anchor" href="#websocket-客户端开发流程" aria-hidden="true">#</a> WebSocket 客户端开发流程</h3><div class="language-js"><pre><code><span class="token comment">// or http://127.0.0.1:7001/chat</span>\n<span class="token keyword">const</span> socket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;socket.io-client&#39;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">&#39;http://127.0.0.1:7001&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nsocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;connect&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;connect!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n  socket<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&#39;chat&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;hello world!&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n\nsocket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;res&#39;</span><span class="token punctuation">,</span> <span class="token parameter">msg</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>\n  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;res from server: %s!&#39;</span><span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\n</code></pre></div><h2 id="redis-入门"><a class="header-anchor" href="#redis-入门" aria-hidden="true">#</a> Redis 入门</h2><h3 id="什么是-redis？"><a class="header-anchor" href="#什么是-redis？" aria-hidden="true">#</a> 什么是 Redis？</h3><p>Redis 基本概念：<a href="https://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/redis/redis-tutorial.html</a></p><h2 id="redis-安装方法"><a class="header-anchor" href="#redis-安装方法" aria-hidden="true">#</a> Redis 安装方法</h2><ul><li>Windows &amp; Linux：<a href="https://www.runoob.com/redis/redis-install.html" target="_blank" rel="noopener noreferrer">https://www.runoob.com/redis/redis-install.html</a></li><li>MacOS：<a href="https://www.cnblogs.com/pangkang/p/12612292.html" target="_blank" rel="noopener noreferrer">https://www.cnblogs.com/pangkang/p/12612292.html</a></li></ul><h3 id="redis-开发流程"><a class="header-anchor" href="#redis-开发流程" aria-hidden="true">#</a> Redis 开发流程</h3><p>Redis 开发流程：<a href="https://www.npmjs.com/package/egg-redis" target="_blank" rel="noopener noreferrer">https://www.npmjs.com/package/egg-redis</a></p>',26);p.render=function(a,t,p,e,c,l){return s(),n("div",null,[o])};export default p;export{t as __pageData};
