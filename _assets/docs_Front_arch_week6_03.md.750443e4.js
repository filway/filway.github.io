import{g as e,f as l,G as i}from"./common-bec3f312.js";const r='{"title":"require源码解析——彻底搞懂npm模块加载原理","frontmatter":{"date":"2022-04-23","title":"require源码解析——彻底搞懂npm模块加载原理","tags":["前端架构师","week6","脚手架"],"describe":null},"headers":[{"level":2,"title":"require的使用场景","slug":"require的使用场景"},{"level":2,"title":"require源码阅读过程中的一些思考","slug":"require源码阅读过程中的一些思考"},{"level":2,"title":"Module对象","slug":"module对象"},{"level":2,"title":"require执行流程","slug":"require执行流程"},{"level":2,"title":"require执行流程总结","slug":"require执行流程总结"},{"level":2,"title":"参考资料","slug":"参考资料"},{"level":2,"title":"扩展知识","slug":"扩展知识"},{"level":3,"title":"require.main的妙用","slug":"require-main的妙用"}],"relativePath":"docs/Front_arch/week6/03.md","lastUpdated":1660147426756.5005}';var a={};const o=i('<h2 id="require的使用场景"><a class="header-anchor" href="#require的使用场景" aria-hidden="true">#</a> require的使用场景</h2><ul><li>加载模块类型： <ul><li>加载内置模块：<code>require(&#39;fs&#39;)</code></li><li>加载node_modules模块：<code>require(&#39;ejs&#39;)</code></li><li>加载本地模块：<code>require(&#39;./utils&#39;)</code></li></ul></li><li>支持文件类型： <ul><li>加载 .js 文件</li><li>加载 .json 文件</li><li>加载 .node 文件</li><li>加载 .mjs 文件</li><li>加载其他类型文件</li></ul></li></ul><h2 id="require源码阅读过程中的一些思考"><a class="header-anchor" href="#require源码阅读过程中的一些思考" aria-hidden="true">#</a> require源码阅读过程中的一些思考</h2><ul><li>CommonJS 加载主模块的流程</li><li>require 如何加载内置模块？</li><li>require 如何加载 node_modules 模块？</li><li>require 为什么会将非 js/json/node 文件视为 js 文件加载？</li><li>require 连续加载同一个模块时，是如何进行缓存的？</li></ul><h2 id="module对象"><a class="header-anchor" href="#module对象" aria-hidden="true">#</a> Module对象</h2><ul><li>id：源码文件路径，如：/Users/sam/Desktop/vue-test/imooc-test/bin/ejs/index.js</li><li>path：源码文件对应的文件夹，通过 <code>path.dirname(id)</code> 生成</li><li>exports：模块输出的内容，默认为 <code>{}</code></li><li>parent：父模块信息</li><li>filename：源码文件路径</li><li>loaded：是否已经加载完毕</li><li>children：子模块对象集合</li><li>paths：模块查询范围</li></ul><h2 id="require执行流程"><a class="header-anchor" href="#require执行流程" aria-hidden="true">#</a> require执行流程</h2><p><img src="https://oss.filway.cn/filway-blog/5ffa6a8a0892df4407561232.jpg" alt="图片描述"></p><h2 id="require执行流程总结"><a class="header-anchor" href="#require执行流程总结" aria-hidden="true">#</a> require执行流程总结</h2><ol><li><code>relativeResolveCache[relResolveCacheIdentifier]</code> 查询缓存路径</li><li><code>Module._cache[filename]</code> 查询缓存模块</li><li><code>Module._resolveFilename</code> 查询模块的真实路径</li><li><code>loadNativeModule</code> 加载内置模块</li><li><code>new Module</code> 实例化 Module 对象</li><li><code>module.load(filename)</code> 加载模块</li><li><code>findLongestRegisteredExtension</code> 获取文件后缀</li><li><code>Module._extensions[extension](this, filename)</code> 解析模块并执行模块</li><li><code>module._compile</code> 编译模块代码</li><li><code>compileFunction</code> 将模块代码生成可执行函数</li><li><code>exports, require, module, filename, dirname</code> 生成入参</li><li><code>compiledWrapper.call</code> 执行模块函数</li><li><code>return module.exports</code> 输出模块返回结果</li></ol><h2 id="参考资料"><a class="header-anchor" href="#参考资料" aria-hidden="true">#</a> 参考资料</h2><ul><li>阮一峰require源码解读：<a href="http://www.ruanyifeng.com/blog/2015/05/require.html" target="_blank" rel="noopener noreferrer">http://www.ruanyifeng.com/blog/2015/05/require.html</a></li><li>UTF8 BOM：<a href="https://www.imooc.com/article/26166" target="_blank" rel="noopener noreferrer">https://www.imooc.com/article/26166</a></li><li>Shebang：<a href="https://blog.csdn.net/u012294618/article/details/78427864" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/u012294618/article/details/78427864</a></li></ul><h2 id="扩展知识"><a class="header-anchor" href="#扩展知识" aria-hidden="true">#</a> 扩展知识</h2><h3 id="require-main的妙用"><a class="header-anchor" href="#require-main的妙用" aria-hidden="true">#</a> require.main的妙用</h3><p>用于测试：<a href="https://blog.csdn.net/qq_29438877/article/details/103828845" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/qq_29438877/article/details/103828845</a></p>',15);a.render=function(i,r,a,d,t,n){return l(),e("div",null,[o])};export default a;export{r as __pageData};
